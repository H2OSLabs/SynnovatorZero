# 6. 社交互动与反馈

- **角色：** 已登录用户（点赞/评论/关注/分享）；评委/组织者（评分）
- **前置条件：** 已登录，目标内容对当前用户可见
- **关联测试：** `specs/testcases/25-social-interaction.md`

## 6.1 点赞

| 用户旅程 | 说明 | 数据操作 |
|---------|------|---------|
| 点赞帖子 | 对喜欢的帖子点赞 | `CREATE interaction`（type: like, target_type: post） |
| 取消点赞 | 取消之前的点赞 | `DELETE interaction`（type: like） |
| 查看点赞数 | 查看帖子的点赞统计 | `READ post`（like_count 缓存字段） |
| 查看点赞列表 | 查看自己点赞的所有内容 | `READ interaction`（type: like, created_by: current_user） |

## 6.2 收藏 (Bookmarking)

用户可以将感兴趣的内容加入收藏夹，便于日后查找。

| 用户旅程 | 说明 | 数据操作 |
|---------|------|---------|
| **收藏内容** | 点击帖子或提案详情页的**星形按钮**进行收藏 | `CREATE interaction` (type: bookmark) |
| 取消收藏 | 再次点击星形按钮取消收藏 | `DELETE interaction` (type: bookmark) |
| 查看收藏夹 | 在个人主页查看自己收藏的所有内容列表 | `READ interaction` (type: bookmark, created_by: current_user) |

## 6.3 评论

| 用户旅程 | 说明 | 数据操作 |
|---------|------|---------|
| 发表评论 | 对帖子发表评论 | `CREATE interaction`（type: comment） |
| **楼中楼回复** | 对已有评论进行回复，支持多级嵌套展示 | `CREATE interaction`（type: comment, parent_id） |
| 删除评论 | 删除自己发表的评论 | `DELETE interaction`（软删除） |
| 查看评论列表 | 查看帖子下的所有评论，前端按层级结构展示 | `READ interaction`（type: comment, target_id） |

## 6.4 评分

| 用户旅程 | 说明 | 数据操作 |
|---------|------|---------|
| 评委打分 | 评委对参赛帖子进行打分 | `CREATE interaction`（type: rating） |
| 修改评分 | 评委修改之前的评分 | `UPDATE interaction`（type: rating） |
| 查看平均分 | 查看帖子的平均评分 | `READ post`（average_rating 缓存字段） |

**约束：**
- 只有被指定为活动评委的用户才能打分
- 每个评委对同一帖子只能打一次分（可修改）
- 评分值需在规则定义的范围内

## 6.5 内容关注

| 用户旅程 | 说明 | 数据操作 |
|---------|------|---------|
| 关注提案 | 订阅特定提案的更新动态 | `CREATE interaction`（type: follow, target_type: post） |
| 关注团队 | 订阅特定团队的动态 | `CREATE interaction`（type: follow, target_type: group） |
| 关注活动 | 订阅特定活动的更新动态 | `CREATE interaction`（type: follow, target_type: event） |
| 取消关注 | 取消对内容的关注 | `DELETE interaction`（type: follow） |
| 查看关注列表 | 查看自己关注的所有内容 | `READ interaction`（type: follow, created_by） |

**约束：**
- 不能关注自己创建的内容
- 关注后收到内容更新通知

## 6.6 分享

| 用户旅程 | 说明 | 数据操作 |
|---------|------|---------|
| 分享活动 | 将活动分享到外部社交媒体 | 生成分享链接/卡片 |
| 分享帖子 | 将帖子分享到外部社交媒体 | 生成分享链接/卡片 |
| 复制链接 | 复制内容链接到剪贴板 | 前端操作，无数据变更 |

**说明：**
- 分享功能主要是前端实现
- 私有内容分享链接需要权限验证

## 6.7 缓存字段维护

以下缓存字段由系统自动维护：

| 字段 | 更新触发 | 说明 |
|------|---------|------|
| `like_count` | 点赞/取消点赞时 | 帖子的点赞总数 |
| `comment_count` | 评论/删除评论时 | 帖子的评论总数 |
| `bookmark_count` | 收藏/取消收藏时 | 帖子的收藏总数 |
| `average_rating` | 评分/修改评分时 | 帖子的平均评分 |

## 6.8 通知触发

以下互动会触发通知：

| 互动类型 | 通知接收者 | 通知内容 |
|---------|-----------|---------|
| 点赞 | 帖子作者 | "{用户} 赞了你的作品" |
| 收藏 | 帖子作者 | "{用户} 收藏了你的作品" |
| 评论 | 帖子作者 | "{用户} 评论了你的作品" |
| 回复 | 被回复者 | "{用户} 回复了你的评论" |
| @提及 | 被提及者 | "{用户} 在评论中提到了你" |
| 关注 | 内容作者 | "{用户} 关注了你的 {内容类型}" |

## 6.9 社交数据可见性 (Social Data Visibility)

社交维度的统计数据**对所有用户（包括访客）公开可见**，但具体列表受用户隐私设置控制：

| 数据指标 | 可见范围 | 说明 |
|---------|---------|------|
| **关注数/粉丝数** | 公开 (Public) | 用户个人主页显示的关注者数量和正在关注的数量 |
| **点赞数 (Likes)** | 公开 (Public) | 帖子、活动或评论获得的点赞总数 |
| **收藏数 (Bookmarks)** | 公开 (Public) | 内容被收藏的总次数 |
| **评论数 (Comments)** | 公开 (Public) | 内容下的评论总条数 |
| **好友/连接数** | 公开 (Public) | 用户的互相关注（好友）数量 |

## 6.10 异常与限制 (Constraints & Edge Cases)

| 场景 | 说明 | 系统行为 |
|------|------|---------|
| **用户拉黑 (Blocking)** | 用户 A 拉黑 用户 B | B **无法**关注、评论、点赞 A 的内容；B 无法查看 A 的个人主页（显示受限）；A 亦无法看到 B 的动态 |
| **内容删除** | 原帖被作者删除 | 关联的评论、点赞记录被**级联隐藏**（或软删除）；已转发/分享的链接失效 |
| **禁言/封号** | 用户被管理员封禁 | 用户发布的历史内容保留但**禁止互动**；用户无法进行任何写操作 (`CREATE/UPDATE/DELETE`) |
| **重复互动** | 短时间内高频操作 | 触发 Rate Limit，系统返回 `429 Too Many Requests`，限制操作 |
