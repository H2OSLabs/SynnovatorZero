/**
 * {{ api_name }} API Client
 * Generated from OpenAPI specification
 */

// ============ Types ============

{% for enum in enums %}
export enum {{ enum.name }} {
  {% for value in enum.values %}{{ value.name }} = "{{ value.value }}",
  {% endfor %}}

{% endfor %}
{% for interface in interfaces %}
export interface {{ interface.name }} {
  {% for field in interface.fields %}{{ field.name }}{% if field.optional %}?{% endif %}: {{ field.type }};
  {% endfor %}}

{% endfor %}
// ============ API Configuration ============

export interface ApiConfig {
  baseUrl: string;
  headers?: Record<string, string>;
}

const defaultConfig: ApiConfig = {
  baseUrl: process.env.NEXT_PUBLIC_API_URL || "http://localhost:8000",
};

class ApiClient {
  private config: ApiConfig;

  constructor(config: Partial<ApiConfig> = {}) {
    this.config = { ...defaultConfig, ...config };
  }

  private async request<T>(
    path: string,
    options: RequestInit = {}
  ): Promise<T> {
    const url = `${this.config.baseUrl}${path}`;
    const headers = {
      "Content-Type": "application/json",
      ...this.config.headers,
      ...options.headers,
    };

    const response = await fetch(url, {
      ...options,
      headers,
    });

    if (!response.ok) {
      const error = await response.json().catch(() => ({
        detail: response.statusText,
      }));
      throw new Error(error.detail || `HTTP ${response.status}`);
    }

    // Handle 204 No Content
    if (response.status === 204) {
      return null as T;
    }

    return response.json();
  }

  // ============ Endpoints ============
{% for endpoint in endpoints %}
  /**
   * {{ endpoint.description }}
   * {{ endpoint.method | upper }} {{ endpoint.path }}
   */
  async {{ endpoint.function_name }}({% if endpoint.params %}
    {% for param in endpoint.params %}{{ param.name }}{% if param.optional %}?{% endif %}: {{ param.type }},
    {% endfor %}{% endif %}{% if endpoint.body %}body: {{ endpoint.body.type }},
    {% endif %}{% if endpoint.query_params %}queryParams?: {
      {% for qp in endpoint.query_params %}{{ qp.name }}?: {{ qp.type }};
      {% endfor %}},
    {% endif %}): Promise<{{ endpoint.return_type }}> {
    let path = "{{ endpoint.path }}";
    {% for param in endpoint.path_params %}path = path.replace("{{'{'}}{{ param.name }}{{'}'}}", String({{ param.name }}));
    {% endfor %}
    {% if endpoint.query_params %}if (queryParams) {
      const query = new URLSearchParams();
      {% for qp in endpoint.query_params %}if (queryParams.{{ qp.name }} !== undefined) {
        query.append("{{ qp.name }}", String(queryParams.{{ qp.name }}));
      }
      {% endfor %}if (query.toString()) {
        path += `?${query.toString()}`;
      }
    }
    {% endif %}
    return this.request<{{ endpoint.return_type }}>(path, {
      method: "{{ endpoint.method | upper }}",
      {% if endpoint.body %}body: JSON.stringify(body),{% endif %}
    });
  }

{% endfor %}}

// ============ Export ============

export const apiClient = new ApiClient();

// Export individual endpoint functions for convenience
{% for endpoint in endpoints %}
export const {{ endpoint.function_name }} = apiClient.{{ endpoint.function_name }}.bind(apiClient);
{% endfor %}

// Export client class for custom configuration
export { ApiClient };
